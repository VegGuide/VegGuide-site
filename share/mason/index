 <div id="main" class="main-front-page">

  <div id="body-and-boxes-container">

   <div id="right-container">

    <& /recent-entries.mas &>
    
    <& /recent-reviews.mas &>

    <& /site-news.mas &>
   </div>

   <div id="body" class="large-boxes">

    <div id="global-nav">
     <ul>
% if ( $c->vg_user()->is_guest() ) {
      <li class="first"><a href="/user/login_form?return_to=<% $c->request()->uri() | uh %>" title="Log in">Log in</a></li>
% } else {
      <li class="first"><a href="<% user_uri( user => $c->vg_user() ) | h %>" title="My account">My account</a></li>
      <li><a id="logout" href="/user/authentication?x-tunneled-method=DELETE;return_to=<% $c->request()->uri() | uh %>" title="Log out">Log out</a></li>
% }
     </ul>
    </div>

    <h1 id="page-title">Welcome to VegGuide.Org!</h1>

    <!--[if lte IE 6]>

      <p class="ie6" style="background-color:#ffeecc; padding: 1em;
                            margin-top: 1em;">
        It looks like you're using IE6. This site probably won't work too well
        for you. If you can,
        please <a href="http://www.quirksmode.org/upgrade.html">upgrade to a
        modern browser</a>. We know that some of you may not have the ability
        to upgrade, but unfortunately supporting IE6 is no longer viable for
        us.
      </p>

    <![endif]-->

% if ($city) {
    <p>
     Looks like you are in <% $city | h %>.
%   if ( my $count = $search->count() ) {
     There <% PL( 'is', $count ) %> <% $count %> <% PL( 'restaurant', $count ) %> nearby.
%     if ( $count > 4 ) {
     Here a few of the closest:
%     }
    </p>
%     my $vendors = $search->vendors();
%     my $location;
    <ul>
%     while ( my $vendor = $vendors->next() ) {
%       $location ||= $vendor->location();
%       my $distance = $vendor->distance_from( latitude => $search->latitude(), longitude => $search->longitude(), unit => $search->unit() );
     <li><& /lib/link/vendor.mas, vendor => $vendor &> - <% $distance %> <% PL( $search->unit, $distance ) %></li>
%     }
%     if ( $count > 4 ) {
%       $search->set_cursor_params( page => 1, limit => $c->vg_user()->entries_per_page() );
     <li><a href="<% $search->uri() %>">More nearby restaurants sorted by distance</a></li>
%     }
    </ul>

    <p>
     Browse other nearby entries in <& /lib/link/location-and-parent.mas, location => $location &>.
    </p>
%   } else {
     We don't have any restaurants near your current
     location. Please <a href="/site/help#editing">add some</a> if you can!
    </p>
%   }
% }

    <p>
     To start browsing, just click on a region in the list below. Or
     search for entries by location or name using the search form above.
    </p>

    <& /lib/region-list.mas, locations => \@locations, columns => 2 &>

    <p>
     VegGuide.Org is a community-maintained, world-wide guide to
     vegetarian and vegan restaurants, grocers, and more.
    </p>

% if ($news_item) {
    <h2>News</h2>

    <h3><& /lib/format/date.mas, date => $news_item->creation_datetime_object() &> - <% $news_item->title() | h %></h3>

    <% $news_item->body() %>
% }

% if ( VegGuide::Config->IsTest() ) {
    <div style="border: 2px solid red; padding: 0 0.4em; margin-bottom: 0.5em;">
    <p>
     <strong>WARNING:</strong> this is a test server,
     so data stored here may be wiped out without any notice. Don't
     do any work here you are not prepared to lose.
    </p>
    </div>
% }

   </div>

  </div>

 </div>

<%args>
$news_item
$city => undef
$search => undef
</%args>

<%init>
my @locations = VegGuide::Location->RootLocations();
</%init>
