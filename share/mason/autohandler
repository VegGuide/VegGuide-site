<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
          "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head profile="http://a9.com/-/spec/opensearch/1.1/">
<meta name="verify-v1" content="S8S8dgpeS5UYctqac1Xv4fsG+sYdS77Qtni99/Y9wds=" />
 <title><& SELF:title &></title>

 <& .rss_link, %ARGS &>

 <link rel="search" type="application/opensearchdescription+xml"
       href="/static/opensearch_desc.xml" title="VegGuide Search" />

 <link rel="shortcut icon" href="/images/favicon.ico" mce_href="/images/favicon.ico" />
 <link rel="stylesheet" type="text/css" href="<% static_uri( path => '/css/vegguide.css' ) %>" />
<!--[if IE]>
 <link rel="stylesheet" type="text/css" href="<% static_uri( path => '/css/ie.css' ) %>" />
<![endif]-->

 <script type="text/javascript">
  var JSAN = { "use": function () {} };
 </script>

 <script src="<% static_uri( path => '/js/vegguide-combined.js' ) %>" type="text/javascript"></script>

</head>

<body>

% if ($is_front_page) {
  <& front-page-header.mas, %ARGS &>
% } else {
  <& .breadcrumbs &>

  <& header.mas, %ARGS &>
% }

% if ( $m->request_comp()->attr('requires_js') ) {
  <div id="requires-js">
   This page requires that you have Javascript enabled in your browser.
  </div>
% }

% if (@messages) {
  <div id="messages" class="<% $is_front_page ? 'front-page' : '' %>">
%   for my $msg (@messages) {
   <p>
    <% $msg | h %>
   </p>
%   }
  </div>
% }

% $m->call_next();

  <& footer.mas, %ARGS &>

% if ( $m->request_comp()->attr('load_google_maps')) {
 <script src="http://maps.google.com/maps?file=api&amp;v=2&amp;key=<% VegGuide::Config->GoogleMapsAPIKey( $c->request()->uri()->host() ) | h %>"
         type="text/javascript"></script>

% }

% if ( VegGuide::Config->IsProduction() ) {
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-1805706-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script');
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    ga.setAttribute('async', 'true');
    document.documentElement.firstChild.appendChild(ga);
  })();

</script>
% }

</body>
</html>

<%args>
$is_front_page => 0
</%args>

<%init>
my @messages = @{ $c->session()->{messages} || [] };
</%init>

<%attr>
load_google_maps => 0
requires_js => 0
</%attr>

<%method title>VegGuide.Org | Vegetarian and Vegan Restaurants, Grocers, and more</%method>

<%def .rss_link>
% for my $link (@links) {
<link rel="alternate" type="<% $link->mime_type() | h %>"
      title="<% $link->title() | h %>"
      href="<% $link->uri() | h %>" />
% }
<%init>
my @links = $c->response()->alternate_links()->all();
return unless @links;
</%init>
</%def>

<%def .breadcrumbs>
<%doc>
This div must always be present so that the vertical layout of the
page does not change with or without breadcrumbs being shown.
</%doc>
 <div id="breadcrumbs">
% if ( @crumbs > 1 ) {
  <ul>
   <li><strong>You are here:</strong></li>
%   foreach my $crumb (@crumbs) {
   <li>
%     if ( $crumb ne $crumbs[0] ) {
     &gt;
%     }

%     if ( $crumb eq $crumbs[-1] ) {
     <strong><% $crumb->label() | h %></strong>
%     } else {
     <a href="<% $crumb->uri() | h %>"><% $crumb->label() | h %></a>
%     }
   </li>
%   }
  </ul>
% } else {
  &nbsp;
% }
 </div>
<%init>
my @crumbs = $c->response()->breadcrumbs()->all();
</%init>
</%def>
