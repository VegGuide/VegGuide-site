   <div id="body">

% if (@children) {
    <& /lib/region-list.mas, location => $location, locations => \@children &>
% }

% if ( ( $c->vg_user()->is_admin() || $location->can_have_child_regions() ) && ! $active_vendor_count ) {
     <div class="content-buttons">
      <a class="content-button" href="<% region_uri( location => $location, path => 'new_region_form' ) | h %>"
         >Add a new region</a>
     </div>
% }

% if ( @children && $active_vendor_count ) {
    <hr />
% }

% if ( $active_vendor_count ) {
    <& /lib/filter-div.mas, location => $location, search => $search &>
% }

% if ( $active_vendor_count ) {
    <& /lib/entries-table.mas, search => $search, pager => $pager &>
% } elsif ( $c->vg_user()->is_admin() || $location->can_have_vendors() ) {
    <div class="content-buttons">
     <a class="content-button" href="<% region_uri( location => $location, path => 'entry_form' ) %>" title="add a new entry to this region">Add Entry</a>
    </div>
% }


% if ($comment_count) {
    <div id="region-comments">
     <h2>Comments about <% $location->name() | h %></h2>

     <& /lib/comments.mas, comments => $comments &>
    </div>
% }

% if ( ( $c->vg_user()->is_admin() || $location->can_have_child_regions() ) && $active_vendor_count ) {
     <div class="content-buttons">
      <a class="content-button" href="<% region_uri( location => $location, path => 'new_region_form' ) | h %>"
         >Add a new region</a>
     </div>
% }

    <div class="content-buttons">
     <a class="content-button" href="<% region_uri( location => $location, path => 'comment_form' ) %>" title="write a comment about this region">Add Comment</a>
    </div>

   </div>

<%args>
$location
$search
</%args>

<%init>
my $active_vendor_count = $location->active_vendor_count();

my @children = $location->children();

my $comment_count = $location->comment_count();

my $comments;
$comments = $location->comments() if $comment_count;

my $pager = $search->pager();
</%init>
