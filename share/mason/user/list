 <div id="main">

  <div id="title-and-info-container" class="no-nav">
   <& /lib/rounded-corners-top.mas &>

   <div id="page-title-and-info">
    <h1 id="page-title">VegGuide.Org Users</h1>
   </div>

  </div>

 </div>

 <div id="body-container">

  <div id="body" class="one-column">

    <&| /lib/filter/fill-in-form.mas, objects => [ $search ] &>
    <form id="user-filter" action="/user" method="get">
     <label for="real_name">Name:</label>
     <input id="real_name" type="text" class="text" name="real_name" />
% if ( $c->vg_user()->is_admin() ) {
     <label for="email_address">Email:</label>
     <input id="email_address" type="text" class="text" name="email_address" />
% }
     <input type="submit" class="submit" value="Search" />
    </form>
    </&>

% if ( $search->matching() ) {
    <h3 id="current-filters-heading">Currently showing users ...</h3>

    <ul>
     <li>with <% $search->matching() | h %>.</li>
    </ul>
% }

    <table id="users-table" class="standard-table">

     <thead>
      <tr>
       <td colspan="<% $col_count %>" class="first last">
        <% $pagination %>
       </td>
      </tr>

      <tr class="table-heading">
       <th id="name-header first"><&| /lib/sort-link.mas, search => $search &>Name</&></th>
% if ( $c->vg_user()->is_admin() ) {
       <th id="email-address-header"><&| /lib/sort-link.mas, search => $search &>Email Address</&></th>
% }
       <th id="signup-date-header"><&| /lib/sort-link.mas, search => $search &>Signup Date</&></th>
       <th id="entry-count-header">Entries</th>
       <th id="review-count-header">Reviews</th>
       <th id="rating-count-header">Ratings</th>
       <th id="button-header last"></th>
      </tr>
     </thead>

% if ( $pager->total_entries() ) {
     <tfoot>
      <tr>
       <td colspan="<% $col_count %>" class="first last">
        <% $pagination %>
       </td>
      </tr>
     </tfoot>
% }

     <tbody>
% while ( my $user = $users->next() ) {
      <tr class="<% $users->count() % 2 ? 'odd' : 'even' %>">
       <td class="first"><& /lib/link/user.mas, user => $user &></td>
% if ( $c->vg_user()->is_admin() ) {
       <td><% $user->email_address() | h %></td>
% }
       <td><& /lib/format/date.mas, date => $user->creation_datetime() &></td>
       <td><% $user->vendor_count() %></td>
       <td><% $user->review_count() %></td>
       <td><% $user->rating_count() %></td>
       <td class="last">
%   if ( $c->vg_user()->can_edit_user($user) ) {
        <a href="<% user_uri( user => $user, path => 'edit_form' ) | h %>"
           class="content-button-medium">Edit</a>
%   }
%   if ( $c->vg_user()->can_delete_user($user) ) {
        <a href="<% user_uri( user => $user, path => 'deletion_confirmation_form' ) | h %>"
           class="action-button-medium">Delete</a>
%   }
       </td>
      </tr>
% }
     </tbody>

    </table>


  </div>

 </div>

<%args>
$search
</%args>

<%init>
my $users = $search->users();
my $pager = $search->pager();

my $pagination =
    $m->scomp( '/lib/pagination.mas',
               pager  => $pager,
               search => $search,
               things => 'users',
             );

my $col_count = $c->vg_user()->is_admin() ? 7 : 6;
</%init>
